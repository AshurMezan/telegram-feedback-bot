## Telegram бот обратной связи

Бот на Node.js для пересылки сообщений от пользователей в админ‑чат и обратных ответов. Поддерживаются текст, фотографии и PDF. Есть чёрный список пользователей (блокировка/разблокировка).

### Технологии
- **Библиотека бота**: `grammy`
- **База данных**: `SQLite` (пакет `sqlite3`), файл `blacklist.sqlite`
- **Переменные окружения**: `dotenv`
- **Логирование**: `pini.js`

### Переменные окружения
Создайте файл `.env` в корне проекта:
```
BOT_API_KEY=ВАШ_TELEGRAM_BOT_TOKEN
CHAT_ID=ID_АДМИН_ЧАТА
```

### Установка и запуск
```
npm install
npm start
```

### Команды бота (для админ‑чата)
- `/help` — показать доступные команды.
- `/get_id_chat` — вывести ID текущего чата.
- `/block <user_id>` — заблокировать пользователя (его сообщения больше не пересылаются).
- `/unblock <user_id>` — разблокировать пользователя.
- `/give_me_all_users` — показать сколько людей активировало бота.
- `/list_users` — список всех user_id (пакетами).
- `/recent_users` — последние N пользователей (по умолчанию 10, максимум 200).
- `/send_news` — сделать рассылку поста. Пока что рассылается только пост с текстом или пыбликация с одной фотографией и текстом.

### Команды бота (для пользователя)
- `/start` — приветствие.
- `/about` — краткая информация о боте.

### Поведение бота
- В личных чатах бот пересылает в админ‑чат:
  - текстовые сообщения,
  - фотографии (с подписью) и без. Внимание: фотографии НЕ должны быть приложенными как файл.
  - PDF‑документы (с подписью) и без.
  К сообщению добавляется заголовок с именем и тег `#user{ID}`.
- В админ‑чате ответ на пересланное сообщение (Reply) отправляется пользователю, чей ID извлекается из заголовка/подписи.
- Сообщения от заблокированных пользователей игнорируются.
- В админском чате можно подготовить пост, но перед публикацией в начала текста добавить `/send_news`.  
[Пример подготовленной публикации в админском чате](IMG/Пример%20из%20админского%20чата.png)  
[Пример полученной от бота рассылки](IMG/Пример%20рассылки%20у%20бота.png)  

### Структура проекта
- `index.js` — точка входа; регистрация команд, обработчики сообщений (text/photo/document), логика пересылки и ответов, подключение меню.
- `commands.js` — обработчики команд (`start`, `about`, `help`, `get_id_chat`) и админ‑команд (`block`, `unblock`), хелпер `isUserBlocked`.
- `menu.js` — список команд для интерфейса Telegram (кнопка «Меню»).
- `db.js` — инициализация SQLite и таблицы `users` для чёрного списка.
- `logger.js` — скрипт логирования работы бота. Использована библиотека  Pino.js.
- `handlers.js` — функции для обработки сообщений.
- `IMG` — можно сразу удалить. В этой папке хранять примеры команды

### Таблицы БД
- `blacklist` — идентификаторы заблокированных пользователей.
- `bot_users` — таблица для тех, кто активировал бота. Данные нужны для рассылки.

### Примечания
- Блокировка распространяется на текст/фото/PDF и прочие сообщения из личных чатов.
- Для корректной работы убедитесь, что бот добавлен в админ‑чат, а `CHAT_ID` соответствует именно этому чату.

## License

Этот проект распространяется по лицензии GNU. Все отчёты о дефектах добавляйте в Issues. Пишите максимально подробно.

